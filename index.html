<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chill Galaxy — Pro Player</title>
<style>
:root{
  --bg:#07060a;
  --accent:#6a11cb;
  --accent2:#2575fc;
  --accent3:#ff5078;
}

/* RESET & BODY */
*{box-sizing:border-box;}
html,body{height:100%;}
body{
  margin:0;padding:0;
  background:var(--bg);
  color:#fff;
  font-family:Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
  display:flex;flex-direction:column;align-items:center;
}

/* BACKGROUND */
.stars{position:fixed;inset:0;background:url('https://www.transparenttextures.com/patterns/stardust.png') repeat;z-index:-3;animation:moveStars 220s linear infinite;opacity:.9}
@keyframes moveStars{from{background-position:0 0}to{background-position:-9000px 4000px}}
.nebula{position:fixed;inset:0;z-index:-2;filter:blur(90px);
  background:
    radial-gradient(circle at 20% 30%, rgba(106,17,203,0.35), transparent 55%),
    radial-gradient(circle at 80% 70%, rgba(37,117,252,0.28), transparent 55%),
    radial-gradient(circle at 50% 50%, rgba(255,80,120,0.12), transparent 60%);
  animation:neb 40s ease-in-out infinite alternate;opacity:.95}
@keyframes neb{from{transform:scale(1)}to{transform:scale(1.12) translate(-20px,20px)}}

/* HEADER */
header{width:100%;max-width:1100px;padding:36px 20px 6px;display:flex;align-items:center;gap:20px;z-index:5}
.logo h1{font-size:1.6rem;margin:0;letter-spacing:0.6px;text-shadow:0 0 14px rgba(106,17,203,0.9),0 0 30px rgba(37,117,252,0.5)}
.logo p{margin:6px 0 0;color:#cfcfcf;font-size:.95rem}

/* MAIN */
main{width:100%;max-width:1100px;padding:18px;display:grid;grid-template-columns:360px 1fr;gap:20px;align-items:start;}

/* PLAYLIST PANEL */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:14px;backdrop-filter: blur(8px);box-shadow:0 6px 30px rgba(0,0,0,0.6)}
.playlist-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.cover{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700}
.meta{flex:1}
.meta h3{margin:0;font-size:1.05rem}
.meta p{margin:4px 0 0;color:#ccc;font-size:.88rem}

/* FILE SELECT BUTTON */
.file-row{display:flex;gap:8px;align-items:center;margin-top:10px}
.file-input{display:none;}
label.btn.secondary{
  cursor:pointer;user-select:none;position: relative;
  display:inline-block;padding:10px 22px;border-radius:999px;
  border:1px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.05);color: #fff;font-weight:600;
  overflow:hidden;transition: all 0.3s ease, transform 0.25s ease, box-shadow 0.25s ease;
  box-shadow: 0 6px 20px rgba(37,117,252,0.3);backdrop-filter: blur(6px);
}
label.btn.secondary::before{
  content:"";position:absolute;inset:0;border-radius:999px;
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  opacity:0.4;filter:blur(12px);transition:opacity 0.3s, transform 0.3s; z-index:-1;
}
label.btn.secondary:hover::before{opacity:0.8;transform:scale(1.2);}
label.btn.secondary:hover{transform:scale(1.05) rotateZ(1deg);box-shadow:0 12px 32px rgba(37,117,252,0.6);}
label.btn.secondary:active{transform:scale(0.95) rotateZ(-1deg);box-shadow:0 6px 20px rgba(37,117,252,0.4);}

/* TRACK LIST */
.playlist{margin-top:12px;max-height:56vh;overflow:auto;padding-right:6px}
.track{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;margin-bottom:8px;cursor:pointer;background:transparent;position:relative;transition:all .25s}
.track .t-index{width:34px;text-align:center;color:#d8d8d8}
.track .t-info{flex:1;position:relative;z-index:2}
.track .t-info .t-title{font-weight:600}
.track:hover{transform:scale(1.02);filter:brightness(1.1);}
.track.active{box-shadow:0 0 15px rgba(106,17,203,0.8);transform:scale(1.04);}

/* PLAYER CARD */
.player-wrap{display:flex;flex-direction:column;gap:14px}
.player-card{display:flex;gap:16px;align-items:center;padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 40px rgba(0,0,0,0.6)}
.player-cover{width:140px;height:140px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700}
.player-meta{flex:1}
.player-meta h2{margin:0;font-size:1.25rem}
.player-meta p{margin:6px 0 0;color:#d0d0d0}

/* CONTROLS */
.controls{display:flex;flex-direction:column;gap:12px;align-items:center}
.big-controls{display:flex;gap:24px;align-items:center}

/* ICON BUTTONS */
.icon-btn{
  width:60px;height:60px;border-radius:50%;border:none;background:rgba(255,255,255,0.05);
  color:#fff;font-size:1.4rem;cursor:pointer;transition: transform 0.25s ease, box-shadow 0.25s ease;
  box-shadow:0 6px 20px rgba(37,117,252,0.4);backdrop-filter: blur(6px);position:relative;overflow:hidden;
}
.icon-btn::before{
  content:"";position:absolute;inset:0;border-radius:50%;
  background: linear-gradient(135deg, #6a11cb, #2575fc);opacity:0.5;
  filter:blur(12px);transition:opacity 0.3s, transform 0.3s; z-index:-1;
}
.icon-btn:hover::before{opacity:1;transform: scale(1.25);}
.icon-btn:hover{transform:scale(1.15) rotateZ(2deg);box-shadow:0 12px 40px rgba(37,117,252,0.8);}
.icon-btn:active{transform:scale(0.95) rotateZ(-2deg);box-shadow:0 6px 20px rgba(37,117,252,0.4);}
.icon-btn.play{
  width:88px;height:88px;font-size:1.7rem;
  background:linear-gradient(145deg, rgba(106,17,203,0.85), rgba(37,117,252,0.75));
  box-shadow:0 12px 42px rgba(37,117,252,0.9);
  animation: pulse 1.8s infinite alternate;
}
@keyframes pulse{
  0%{transform:scale(1);box-shadow:0 12px 42px rgba(37,117,252,0.6);}
  50%{transform:scale(1.12);box-shadow:0 18px 50px rgba(37,117,252,0.9);}
  100%{transform:scale(1);box-shadow:0 12px 42px rgba(37,117,252,0.6);}
}

/* PROGRESS */
.progress-row{width:100%;display:flex;align-items:center;gap:10px}
.time{font-size:.85rem;color:#cfcfcf;width:48px;text-align:center}
input[type="range"].progress{flex:1;appearance:none;height:8px;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:8px}
input[type="range"].progress::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.4)}

.row-bottom{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-top:8px}
.volume{display:flex;align-items:center;gap:8px}

/* VISUALIZER */
canvas.visual{width:100%;height:70px;border-radius:10px;display:block;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));}

/* FOOTER */
footer{width:100%;max-width:1100px;padding:18px;color:#bbb;font-size:.9rem;text-align:center;opacity:.95}

/* RESPONSIVE */
@media (max-width:980px){
  main{grid-template-columns:1fr; padding:12px}
  .player-cover{width:112px;height:112px}
}
</style>
</head>
<body>
<div class="stars" aria-hidden="true"></div>
<div class="nebula" aria-hidden="true"></div>

<header>
  <div class="logo">
    <h1>Galaxy Music</h1>
    <p>Web phát nhạc chuyên nghiệp — Bấm Play để bắt đầu</p>
  </div>
</header>

<main>
  <div class="panel">
    <div class="playlist-header">
      <div class="cover" id="sideCover">CG</div>
      <div class="meta">
        <h3>Playlist Chill</h3>
        <p>Chọn file MP3 từ máy để nghe !.</p>
      </div>
    </div>

    <div class="file-row">
      <input type="file" id="fileInput" class="file-input" accept="audio/*" multiple>
      <label for="fileInput" class="btn secondary">Chọn MP3 Từ Máy Tính</label>
    </div>

    <div class="playlist" id="playlist"></div>
  </div>

  <div class="player-wrap">
    <div class="player-card">
      <div class="player-cover" id="mainCover">CG</div>
      <div class="player-meta">
        <h2 id="title">Chưa có bài</h2>
        <p id="artist">—</p>

        <div class="controls">
          <div class="big-controls">
            <button class="icon-btn prev">⏮</button>
            <button class="icon-btn play">▶</button>
            <button class="icon-btn next">⏭</button>
          </div>

          <div class="progress-row">
            <div class="time" id="currentTime">0:00</div>
            <input type="range" class="progress" id="progress" min="0" max="100" value="0" />
            <div class="time" id="duration">0:00</div>
          </div>

          <canvas id="vis" class="visual"></canvas>

          <div class="row-bottom">
            <div class="volume">
              <label style="font-size:.95rem;color:#ddd">Volume</label>
              <input id="volume" type="range" min="0" max="1" step="0.01" value="0.55" />
            </div>
            <div style="color:#cfcfcf;font-size:.95rem" id="status">Sẵn sàng</div>
          </div>

        </div>
      </div>
    </div>
  </div>
</main>

<footer>Made with ❤️ by Nguyễn Hoàng Sang.</footer>

<script>
// ---------------- PLAYER JS ----------------
const fileInput = document.getElementById('fileInput');
const playlistEl = document.getElementById('playlist');
const title = document.getElementById('title');
const mainCover = document.getElementById('mainCover');
const currentTimeEl = document.getElementById('currentTime');
const durationEl = document.getElementById('duration');
const progress = document.getElementById('progress');
const playBtn = document.querySelector('.icon-btn.play');
const volumeSlider = document.getElementById('volume');
const status = document.getElementById('status');
const nextBtn = document.querySelector('.icon-btn.next');
const prevBtn = document.querySelector('.icon-btn.prev');

let audio = new Audio();
let isPlaying = false;
let tracks = [];
let currentIndex = -1;

// AudioContext cho visualizer
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
let source;

// ---------------- Play/Pause ----------------
playBtn.addEventListener('click', async () => {
  if(!audio.src) return;
  if(audioCtx.state === 'suspended') await audioCtx.resume();
  if(isPlaying){
    audio.pause();
    playBtn.textContent='▶';
    status.textContent='Tạm dừng';
  } else {
    audio.play().catch(()=>status.textContent='Không thể phát nhạc');
    playBtn.textContent='⏸';
    status.textContent='Đang phát...';
  }
  isPlaying = !isPlaying;
});

// ---------------- NEXT / PREV ----------------
nextBtn.addEventListener('click',()=>{if(currentIndex+1<tracks.length) playTrack(currentIndex+1);});
prevBtn.addEventListener('click',()=>{if(currentIndex-1>=0) playTrack(currentIndex-1);});

// ---------------- FILE INPUT ----------------
fileInput.addEventListener('change', (e)=>{
  const files = Array.from(e.target.files).filter(f=>f.type.includes('audio'));
  if(!files.length) return;

  const newTracks = files.map((file,index)=>({
    name:file.name,
    url:URL.createObjectURL(file),
    index: tracks.length + index
  }));
  tracks = tracks.concat(newTracks);

  playlistEl.innerHTML='';
  tracks.forEach(track=>{
    const div=document.createElement('div');
    div.className='track';
    div.innerHTML=`<div class="t-index">${track.index+1}</div><div class="t-info"><div class="t-title">${track.name}</div></div>`;
    div.addEventListener('click',()=>playTrack(track.index));
    playlistEl.appendChild(div);
  });

  if(currentIndex === -1) playTrack(0);
});

// ---------------- PLAY TRACK ----------------
function playTrack(index){
  if(index<0 || index>=tracks.length) return;
  currentIndex=index;
  const track=tracks[index];
  audio.src=track.url;
  audio.load();
  audio.play().catch(()=>status.textContent='Không thể phát nhạc');
  isPlaying=true;
  playBtn.textContent='⏸';
  title.textContent=track.name;
  mainCover.textContent='🎵';
  status.textContent='Đang phát...';

  document.querySelectorAll('.track').forEach((t,i)=>t.classList.toggle('active',i===index));
  
  // kết nối visualizer
  if(!source){
    source = audioCtx.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
  }
}

// ---------------- PROGRESS ----------------
audio.addEventListener('timeupdate', ()=>{
  const cur=Math.floor(audio.currentTime);
  const dur=Math.floor(audio.duration)||0;
  const formatTime = s=>`${Math.floor(s/60)}:${('0'+(s%60)).slice(-2)}`;
  currentTimeEl.textContent=formatTime(cur);
  durationEl.textContent=formatTime(dur);
  if(dur) progress.value=(cur/dur)*100;
});

// ---------------- TUA NHẠC ----------------
progress.addEventListener('input', e=>{
  const dur=audio.duration||0;
  audio.currentTime=(e.target.value/100)*dur;
});

// ---------------- VOLUME ----------------
volumeSlider.addEventListener('input', e=>{
  audio.volume=e.target.value;
});

// ---------------- VISUALIZER ----------------
const canvas=document.getElementById('vis');
const ctx=canvas.getContext('2d');
analyser.fftSize=256;
const bufferLength=analyser.frequencyBinCount;
const dataArray=new Uint8Array(bufferLength);

function draw(){
  requestAnimationFrame(draw);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  analyser.getByteFrequencyData(dataArray);

  const barWidth = canvas.width / bufferLength;
  for(let i=0;i<bufferLength;i++){
    const barHeight = dataArray[i];
    const x = i*barWidth;
    const y = canvas.height - barHeight*canvas.height/256;
    const hue = i*3;
    ctx.fillStyle=`hsl(${hue},100%,65%)`;
    ctx.fillRect(x,y,barWidth,barHeight*canvas.height/256);
  }
}
draw();

// Resize canvas
window.addEventListener('resize',()=>{canvas.width=canvas.clientWidth;canvas.height=canvas.clientHeight;});
canvas.width=canvas.clientWidth;
canvas.height=canvas.clientHeight;

</script>
</body>
</html>
